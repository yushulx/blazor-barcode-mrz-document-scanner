@page "/barcodereader"
@inject IJSRuntime JSRuntime

<button @onclick="ReadBarcodes">Select an image</button>
<p class="p-result">@result</p>

<div id="imageview">
    <img id="image" />
    <canvas id="overlay"></canvas>
</div>

@code {
    String result = "";
    private DotNetObjectReference<Reader> objRef;

    protected override void OnInitialized()
    {
        objRef = DotNetObjectReference.Create(this);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Call the JavaScript function when the page is loaded
            await JSRuntime.InvokeVoidAsync("jsFunctions.initReader");
        }
    }


    public async Task ReadBarcodes()
    {
        await JSRuntime.InvokeVoidAsync(
        "jsFunctions.selectFile", objRef, "overlay", "image");
    }

    [JSInvokable]
    public void ReturnBarcodeResultsAsync(String text)
    {
        result = text;
        StateHasChanged();
    }

    public void Dispose()
    {
        objRef?.Dispose();
    }
}
